# ğŸ› ï¸ **Nmap_Notes.md**

### *Beginner â†’ Intermediate Nmap Guide Focused on Pentesting Labs (TryHackMe, PNPT, OSCP Prep)*

---

# ğŸ“Œ **Purpose of This File**

This file exists as a **universal reference** for all of your TryHackMe rooms, CTFs, HackTheBox boxes, and future offensive security labs.

It explains:

* how Nmap actually works under the hood
* why certain commands behave differently
* when to use each type of scan
* how to read results intelligently
* and why some scans â€œhang,â€ â€œstall,â€ or â€œfind nothingâ€

Everything here comes from the real situations you encountered in the **BLUE** room.

---

# ğŸ§© **1. What Nmap Actually Does (2-Phase Scanning)**

### **Phase 1 â€” Port Discovery**

Nmap checks ports to find out which ones are:

* open
* closed
* filtered
* unfiltered

Without specifying any `-p` flag, Nmap scans the **Top 1000 most common ports** by default.

### **Phase 2 â€” Service Detection**

After open ports are discovered, then Nmap:

* queries the open ports
* analyzes the responses
* tries to identify the service
* determines the version
* pulls banners if available

This second phase is what the `-sV` flag specifically controls:
ğŸ‘‰ **Version detection**

---

# âš™ï¸ **2. Why Ports Were Scanned Without `-p`**

You ran:

```
nmap -sV -vv --script vuln <target>
```

You did NOT specify:

* `-p 1-65535`
* `-p-`
* or any port range

### So why did Nmap still show you open ports?

Because:

### ğŸ‘‰ Nmap **automatically** scans the TOP 1000 PORTS unless you override it.

This includes ports like:

* 22 (SSH)
* 80, 443 (HTTP/HTTPS)
* 135, 139, 445 (Windows RPC/SMB)
* 3389 (RDP)
* etc.

These 1000 ports make up **~95% of exposed real-world services**, so itâ€™s a smart starting point.

---

# ğŸ” **3. What `-sV` Actually Does**

### (It's more than "version detection")

`-sV` enables **service fingerprinting**.

Process:

1. Nmap finds an open port
2. Nmap sends **probe packets** to that port
3. The service replies
4. Nmap compares the reply against its database (nmap-service-probes)
5. Nmap tells you:

   * service name
   * software version
   * product family
   * OS family

Example:

```
445/tcp open microsoft-ds Windows 7 - 10 microsoft-ds
```

Without `-sV`, you'd see only:

```
445/tcp open microsoft-ds
```

---

# ğŸš¨ **4. What `--script vuln` Does**

### *(Nmap Vulnerability Check Scripts)*

This flag tells Nmap to run all scripts in the **vuln category** from the NSE (Nmap Scripting Engine).

These scripts perform **real vulnerability checks**, such as:

* SMB vulnerabilities
* MS08-067
* MS17-010 (EternalBlue)
* SSL/TLS flaws
* FTP problems
* Bad configurations
* Outdated services
* Weak encryption

These arenâ€™t just banner checks â€” they are **probe-based vulnerability tests**.

Example from BLUE:

```
smb-vuln-ms17-010: VULNERABLE
```

That script works by:

* sending SMB probes
* analyzing the error message returned by the Windows host
* checking if the host responds in a way that matches known vulnerable behavior

This ties directly to a known CVE:

* **CVE-2017-0143** (EternalBlue)

---

# ğŸ§  **5. Version Guessing vs. Real Vulnerability Testing**

### âŒ Incorrect way (naive):

â€œWindows 7? SMBv1? Must be vulnerable.â€

### âœ”ï¸ Correct way (probe-based):

Nmap script actually interacts with the service and checks:

* error codes
* negotiation failures
* malformed packet responses
* known fingerprint patterns

This method is FAR more accurate than checking software version numbers.

---

# ğŸŒ€ **6. Why Your First Scan Struggled (`-p- -sC -sV -oA`)**

Your attempted scan:

```
nmap -sC -sV -p- -oA scan_results <target>
```

This is very powerful, but slow because:

* `-p-` scans **all 65,535 ports**
* `-sC` runs default scripts
* `-sV` probes every open port
* `-oA` saves in 3 formats
* THM networks sometimes throttle packets

This combination often produces â€œhangingâ€ behavior or long timing messages.

---

# âš¡ **7. Fast and Reliable Nmap Workflows**

Use these depending on the task.

### **ğŸŸ¢ Quick Scan â€” Fastest enumeration**

```
nmap -sC -sV <target>
```

### **ğŸ”µ Port Discovery (when you donâ€™t know whatâ€™s open)**

```
nmap -p- --min-rate 3000 -T4 <target>
```

### **ğŸŸ£ Service Detection only on open ports**

```
nmap -sV -p <ports> <target>
```

### **ğŸ”´ Vulnerability Scan**

```
nmap -sV --script vuln <target>
```

### **ğŸŸ¡ Full, heavy, OSCP-style scan**

```
nmap -sC -sV -p- -A <target>
```

---

# ğŸ§¬ **8. Default Scripts (`-sC`) vs Vulnerability Scripts (`--script vuln`)**

| Flag            | Meaning             | Purpose                                         |
| --------------- | ------------------- | ----------------------------------------------- |
| `-sC`           | Default NSE scripts | Safe general checks (auth, ssl, smb, ftp, misc) |
| `--script vuln` | Vulnerability tests | Actively look for known weakness (CVE-mapped)   |

---

# ğŸ§  **9. Quick Decision Tree (For Future You)**

### â“ *â€œI donâ€™t know anything about the target.â€*

â†’ Run a fast top-1000 scan:

```
nmap -sC -sV <ip>
```

### â“ *â€œI think itâ€™s Windows, Samba, SMB, or old OS.â€*

â†’ Run vuln scan:

```
nmap -sV --script vuln <ip>
```

### â“ *â€œI need every port.â€*

â†’ Run a full port scan:

```
nmap -p- <ip>
```

### â“ *â€œI need a full, deep enumeration for OSCP-style lab.â€*

â†’ Run:

```
nmap -A -p- <ip>
```

---

# ğŸ§  **10. Terms Glossary**

### **Open Port**

Accepts connections; service is listening.

### **Filtered**

Firewall blocking probes.

### **Unfiltered**

Nmap can reach it but cannot determine state.

### **Service Detection (`-sV`)**

Fingerprinting the service running behind the port.

### **Vulnerability Scan (`--script vuln`)**

Checks if known CVEs apply **based on actual responses**.

### **Top 1000 Ports**

Nmapâ€™s default scanning set consisting of the most common real-world ports.

---

# ğŸ“š **11. Cheat Sheet (Your Personal Commands)**

```
# Fast scan (Top 1000 ports + services)
nmap -sC -sV <ip>

# Full port scan
nmap -p- <ip>

# Vulnerability scan
nmap -sV --script vuln <ip>

# Save outputs to files
nmap -oA results <ip>

# Aggressive full scan (OSCP style)
nmap -A -p- <ip>
```

---

# ğŸ“ **12. How This Connects to BLUE Cookbook**

In the BLUE room:

* Your full scan hung because of `-p- -sC -sV -oA` being very heavy
* The THM hint scan worked because Windows-specific vuln scripts identified MS17-010
* This file should be referenced from BLUE.md as your â€œDeep Dive on Nmap Conceptsâ€

Insert in BLUE.md:

```
> ğŸ” For a deeper explanation of the Nmap concepts used in this task, see my Nmap_Notes.md.
```

ğŸ§® Filtering for Ports Under 1000 (or Any Range)

When a room asks something like â€œHow many ports are open under 1000?â€, you simply filter by port number range.

Example filter logic:

0â€“999 â†’ â€œunder 1000â€

Only count lines marked â€œopenâ€

Ignore higher ephemeral ports (49152+ in this case)

General-purpose tip to include in your notes:
```
# Show only ports under 1000 from an existing scan
grep -E "^[0-9]{1,3}/tcp|[0-9]{1,3}$" scan_results.nmap

# Combine commands through Running Nmap, Piping the output in grep, save matching lines to file
nmap -sV -vv --script vuln <target_ip> \
    | grep -E "^[0-9]{1,3}/tcp|[0-9]{1,3}$" \
    > scan_results.nmap

```
Or just manually read them visually.
