# Nmap: The Basics

Learn how to use **Nmap** (Network Mapper) to discover live hosts, find open ports, and detect service versions.  
This lesson introduces core scanning techniques, timing options, verbosity control, and saving results efficiently.

---

## Task 1: Introduction

When connected to a network, two common questions arise:
1. Which devices are currently online?
2. What services are running on those devices?

Manually checking all 254 possible IPs in a `/24` network (e.g., `192.168.0.1–254`) is inefficient. Tools like `ping`, `arp-scan`, or `telnet` can help, but each has limitations — for example, `ping` fails when ICMP is blocked.  
**Nmap** provides a reliable, flexible way to automate this discovery process.

### Learning Objectives
- Discover live hosts  
- Find running services  
- Distinguish port scan types  
- Detect service versions  
- Control scan timing  
- Format output

✅ *Answer:* It’s time to find out who is listening on the network.

---

## Task 2: Host Discovery – Who Is Online

Nmap can discover active hosts in a network. You can specify targets as:
- IP range: `192.168.0.1-10`
- Subnet: `192.168.0.1/24`
- Hostname: `example.thm`

Use the `-sn` flag for **ping scans** (no port scanning).

```bash
# Local network discovery
sudo nmap -sn 192.168.66.0/24
````

**Example output:**

```
Nmap scan report for 192.168.66.1
Host is up (0.09s latency).
MAC Address: A4:DF:65:0B:FE:6C (Unknown)
```

When scanning a **remote** network (through routers), Nmap cannot use ARP.
It sends ICMP echo and TCP/UDP packets to detect if hosts are alive.

✅ *Answer:* The last IP scanned in `192.168.0.1/27` is `192.168.0.31`.

---

## Task 3: Port Scanning – Who Is Listening

Once hosts are identified, Nmap determines which **ports** are open.

### Common Scan Types

| Option      | Description                                           |
| :---------- | :---------------------------------------------------- |
| `-sT`       | TCP Connect scan – completes the full 3-way handshake |
| `-sS`       | SYN scan – half-open or “stealth” scan                |
| `-sU`       | UDP scan                                              |
| `-F`        | Fast mode – scans top 100 ports                       |
| `-p[range]` | Custom port range, e.g. `-p1-1024`                    |

### Example 1 – TCP Connect Scan

```bash
sudo nmap -sT 192.168.124.211
```

**Output (simplified):**

```
PORT   STATE  SERVICE
22/tcp open   ssh
```

✅ *6 TCP ports were open on the target system.*

### Example 2 – SYN (Stealth) Scan

```bash
sudo nmap -sS 192.168.124.211
```

Only sends SYN packets—connection never fully completes. Quieter and faster.

### Example 3 – UDP Scan

```bash
sudo nmap -sU 192.168.124.211
```

Sends UDP packets; ICMP “port unreachable” messages imply closed ports.

### Limiting Target Ports

```bash
sudo nmap -p1-25 192.168.124.211   # Scan only ports 1-25
sudo nmap -F 192.168.124.211       # Scan top 100 ports
```

✅ *Flag on web server:* `THM{SECRET_PAGE_38B9P6}`

---

## Task 4: Version Detection – Extract More Information

Use Nmap to identify service versions and OS details.

### OS Detection

```bash
sudo nmap -O 192.168.124.211
```

**Output (example):**

```
Running: Linux 4.X/5.X
OS CPE: cpe:/o:linux:linux_kernel:4
```

### Service and Version Detection

```bash
sudo nmap -sV 192.168.124.211
```

Displays detected software names and versions.

**Combined Scan Example**

```bash
sudo nmap -A 192.168.124.211
```

Performs OS detection, version detection, and traceroute.

✅ *Detected service:* `lighttpd 1.4.74`

---

## Task 5: Timing – How Fast is Fast

Nmap provides timing templates to control scan speed.
Use `-T<0–5>` or by name (`-T paranoid`, `-T sneaky`, etc.):

| Template | Description | Approximate Speed           |
| :------- | :---------- | :-------------------------- |
| T0       | Paranoid    | 9.8 hours                   |
| T1       | Sneaky      | 27.5 minutes                |
| T2       | Polite      | 40.5 seconds                |
| T3       | Normal      | 0.15 seconds                |
| T4       | Aggressive  | 0.13 seconds                |
| T5       | Insane      | Fastest (risk of detection) |

Example:

```bash
sudo nmap -sS -T4 192.168.124.211
```

✅ *Non-numeric equivalent of `-T4` is `-T aggressive`.*

---

## Task 6: Output – Controlling What You See

### Verbosity and Debugging

Increase output detail with:

```bash
sudo nmap -v 192.168.139.1/24      # Verbose
sudo nmap -vvv 192.168.139.1/24    # Very verbose
sudo nmap -d 192.168.139.1/24      # Debug mode
sudo nmap -d9 192.168.139.1/24     # Maximum debug
```

### Saving Scan Reports

Nmap can save results in various formats:

| Option           | Format                     |
| :--------------- | :------------------------- |
| `-oN <file>`     | Normal text                |
| `-oX <file>`     | XML                        |
| `-oG <file>`     | Grepable (for scripts)     |
| `-oA <basename>` | All formats simultaneously |

```bash
sudo nmap -sS 192.168.139.1 -oA gateway
```

Generates:

```
gateway.nmap
gateway.gnmap
gateway.xml
```

✅ *Option to enable debugging:* `-d`

---

## Task 7: Conclusion and Summary

Nmap enables efficient network mapping and reconnaissance.
Running as `sudo` unlocks advanced capabilities such as raw packet crafting (e.g., SYN scans). Without it, Nmap defaults to the Connect Scan (`-sT`).

| Category              | Option                                    | Description                               |
| :-------------------- | :---------------------------------------- | :---------------------------------------- |
| **Listing**           | `-sL`                                     | List scan – list targets without scanning |
| **Host Discovery**    | `-sn`                                     | Ping scan                                 |
| **Port Scanning**     | `-sT`                                     | TCP Connect (default non-root)            |
|                       | `-sS`                                     | TCP SYN (stealth)                         |
|                       | `-sU`                                     | UDP scan                                  |
|                       | `-F`                                      | Fast scan (100 ports)                     |
|                       | `-p[range]`                               | Define port range                         |
| **Service Detection** | `-O`                                      | OS detection                              |
|                       | `-sV`                                     | Version detection                         |
|                       | `-A`                                      | Full suite (OS + version + traceroute)    |
| **Timing**            | `-T0–5`                                   | Speed templates                           |
|                       | `--min-rate` / `--max-rate`               | Packet rate control                       |
|                       | `--min-parallelism` / `--max-parallelism` | Control parallel probes                   |
|                       | `--host-timeout`                          | Limit time per host                       |
| **Real-time Output**  | `-v`                                      | Verbosity                                 |
|                       | `-d`                                      | Debugging                                 |
| **Reports**           | `-oN`, `-oX`, `-oG`, `-oA`                | Output formats                            |

✅ *If run as a local user (no sudo), Nmap defaults to a Connect Scan (`-sT`).*

---

## Key Takeaways

* **`nmap -sn`** → Discover online hosts without scanning ports.
* **`nmap -sS`** → Fast, stealthy SYN scan.
* **`nmap -sV` / `-O` / `-A`** → Gather service and OS information.
* **`nmap -T<value>`** → Adjust speed and stealth.
* **`nmap -oA report`** → Save results in all formats.
* **Run with `sudo`** for full feature access (non-root scans are limited).

Nmap remains a cornerstone tool for reconnaissance and network auditing — combining speed, flexibility, and depth.

