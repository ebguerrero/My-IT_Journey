# 🧩 John the Ripper: The Basics

## 🧠 Learning Objectives

By the end of this room, you will understand:

* How John the Ripper (JtR) identifies and cracks hashes.
* How to use wordlists, single-crack, and rule-based attacks.
* How to convert hashes from various file types (ZIP, RAR, SSH).
* How to create and test **custom cracking rules**.
* How to use `--show` to display cracked results clearly.

---

## 🧩 Task 1 – Introduction

John the Ripper (JtR) is a **well-known password-cracking tool** supporting a vast range of hash types and formats.
It’s extremely efficient and often used in both **penetration testing** and **CTF** environments.

**Prerequisites:** Cryptography Basics · Public Key Cryptography Basics · Hashing Basics

You will learn to crack Windows authentication hashes, `/etc/shadow` hashes, password‑protected ZIP/RAR files, and SSH private keys.

---

## 🧩 Task 2 – Basic Terms

### 🔹 What Are Hashes?

A **hash** is a fixed-length representation of data, produced by hashing algorithms such as **MD4, MD5, SHA1, SHA256, NTLM**.
It is one-way (non‑reversible in practice) and deterministic.

Example:

```bash
echo -n "polo" | md5sum
# b5379f56e692d7af11b579d3946d4a
```

**Most popular extended build of John:** **Jumbo John**

---

## 🧩 Task 3 – Setting Up Your System

If using the TryHackMe AttackBox or Kali, **Jumbo John** is preinstalled.

Check version:

```bash
john
# John the Ripper 1.9.0-jumbo-1 [...]
```

Install (Debian/Ubuntu):

```bash
sudo apt update && sudo apt install -y john
```

### 🔹 Wordlists

Most tasks use **rockyou.txt** (from rockyou.com, 2009 breach):

```bash
/usr/share/wordlists/rockyou.txt
```

Answer: **rockyou.com**

---

## 🧩 Task 4 – Cracking Basic Hashes

### 🔹 John Basic Syntax

```bash
john [options] [file]
```

**Breakdown**

* `john` — invokes the John the Ripper program.
* `[options]` — flags that control how John runs (wordlist, format, single mode, etc.).
* `[file]` — the hash file to crack (one hash per line). If the file is in the current directory, just use the filename.

**Quick example**

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash_to_crack.txt
```

### 🔹 Automatic Cracking (wordlist mode)

```bash
john --wordlist=[path to wordlist] [path to file]
```

**Breakdown**

* `--wordlist=` — enable wordlist mode; John reads candidates from the given file.
* `[path to wordlist]` — path to the dictionary (e.g., `/usr/share/wordlists/rockyou.txt`).
* `[path to file]` — the hash file you want to crack.

**Example**

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash_to_crack.txt
```

### 🔹 Identify Hash Type (when auto‑detection struggles)

Use a helper such as **hash-id.py** or an online identifier to guess the format.

```bash
python3 hash-id.py
```

### 🔹 Format-Specific Cracking

```bash
john --format=[format] --wordlist=[path to wordlist] [path to file]
```

**Breakdown**

* `--format=` — tell John the exact hash format.
* `[format]` — e.g., `raw-md5`, `raw-sha1`, `sha256crypt`, `nt` (NTLM). Classic MD5/SHA1 usually use the `raw-` prefix.
* `--wordlist=` — dictionary to try.
* `[path to file]` — hash file.

**Example**

```bash
john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hash_to_crack.txt
```

**Tip (list formats):**

```bash
john --list=formats | grep -i "md5"
```

### 🧩 Practical (answers)

| Hash File | Type      | Cracked Value |
| --------- | --------- | ------------- |
| hash1.txt | md5       | biscuit       |
| hash2.txt | sha1      | kangeroo      |
| hash3.txt | sha256    | microphone    |
| hash4.txt | whirlpool | colossal      |

**Pro Tip – always show results:**

```bash
john --show --format=<format> <hashfile>
```

---

## 🧩 Task 5 – Cracking Windows Authentication Hashes

Windows stores user credentials as **NTHash / NTLM**.

```bash
john --format=nt --wordlist=/usr/share/wordlists/rockyou.txt ntlm.txt
john --show --format=nt ntlm.txt
```

Answers: `--format=nt` · cracked password **mushroom**

---

## 🧩 Task 6 – Cracking /etc/shadow Hashes

### 🔹 Unshadowing (combine `/etc/passwd` + `/etc/shadow`)

```bash
unshadow [path to passwd] [path to shadow] > unshadowed.txt
```

**Breakdown**

* `unshadow` — merges account info from `/etc/passwd` with password hashes from `/etc/shadow` into a format John understands.
* `[path to passwd]` — file containing the copied `/etc/passwd` lines from target.
* `[path to shadow]` — file containing the copied `/etc/shadow` lines from target.
* `> unshadowed.txt` — save merged output for cracking.

**Example**

```bash
unshadow local_passwd local_shadow > unshadowed.txt
john --wordlist=/usr/share/wordlists/rockyou.txt --format=sha512crypt unshadowed.txt
john --show --format=sha512crypt unshadowed.txt
```

Answer: root password **1234**

---

## 🧩 Task 7 – Single Crack Mode

**Single mode** generates guesses from usernames + GECOS fields (e.g., Markus → Markus1, M4rkus!, etc.).

```bash
john --single --format=raw-sha256 hashes.txt
john --show  --format=raw-sha256 hashes.txt
```

Answer: Joker’s password **JoKr**

---

## 🧩 Task 8 – Custom Rules

Custom rules let you encode **human password patterns** and exploit **password‑complexity predictability**.

### 🔹 Example rule (from lesson)

```bash
[List.Rules:PoloPassword]
Az"[0-9][!@#]"
```

**Meaning**

* `A` append · `z` capitalize first letter.
* `[0-9]` append a digit 0–9.
* `[!@#]` append one symbol from the set.

Run with:

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt --rules=PoloPassword hash.txt
```

**Answers:**

* Exploit: *password complexity predictability*
* Append capitals rule example: `Az"[A-Z]"`
* Call a custom rule named `THMRules` with: `--rule=THMRules`

### ⚙️ Hands-On Example: Building and Testing a Custom Rule

Minimal lab to practice the pattern expansion missing from the lesson.

```bash
# 1) Make a workspace
mkdir -p ~/john-custom-rules && cd ~/john-custom-rules

# 2) Create a base wordlist
printf "polopassword\nadmin\npassword\n" > base.txt

# 3) Define a custom rule in a local config
cat <<'EOF' > john-local.conf
[List.Rules:DemoRule]
# c  = capitalize first character
# A  = append to the end of the word
# z  = (when used as cAz) preserves uppercase first letter
# "[0-9][!@#]" = append a digit 0-9, then append one of !,@,#
cAz"[0-9][!@#]"
EOF

# 4) Make a target hash that matches our rule output
#    Target plaintext: Polopassword5!
echo -n 'Polopassword5!' | md5sum | awk '{print $1}' > testhash.txt

# 5) Crack using the rule from the local config
john --wordlist=base.txt --rules=DemoRule --format=raw-md5 testhash.txt --config=john-local.conf

# 6) Show cracked result (without re-cracking)
john --show --format=raw-md5 testhash.txt
```

---

## 🧩 Task 9 – Cracking Password‑Protected ZIP Files

Convert then crack:

```bash
zip2john zipfile.zip > zip_hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt zip_hash.txt
john --show zip_hash.txt
```

Answers: password **pass123** · flag **THM{w3ll_d0n3_h4sh_r0y4l}**

---

## 🧩 Task 10 – Cracking Password‑Protected RAR Archives

```bash
rar2john rarfile.rar > rar_hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt rar_hash.txt
john --show rar_hash.txt
```

Answers: password **password** · flag **THM{r4r_4rch1ve5_th15_t1m3}**

---

## 🧩 Task 11 – Cracking SSH Keys with John

```bash
/opt/john/ssh2john.py id_rsa > id_rsa_hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_hash.txt
john --show id_rsa_hash.txt
```

Answer: SSH key password **mango**

---

## 🧩 Task 12 – Further Reading

* Explore incremental mode, hybrid rulechains, GPU/OpenCL builds.
* Openwall Wiki – John the Ripper.

---

## ⚠️ Supplementary Notes & Caveats

### 🔸 `--show` is essential

TryHackMe doesn’t emphasize `--show`, but it is **critical** for clear results:

```bash
john --show --format=<format> <hashfile>
```

### 🔸 Lesson gap: rule practice

The **Custom Rules** lab above provides a ready‑to‑run, commented workflow you can copy/paste and adapt.
